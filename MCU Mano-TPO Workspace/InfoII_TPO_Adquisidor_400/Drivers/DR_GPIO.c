/*******************************************************************************************************************************//**
 *
 * @file		DR_GPIO.c
 * @brief		--Descripción del Módulo--
 * @date		Nov 22, 2018
 * @author		Esteban E. Chiama
 *
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** INCLUDES
 **********************************************************************************************************************************/

#include "DR_GPIO.h"

/***********************************************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** PROTOTIPO DE FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

 /***********************************************************************************************************************************
 *** FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

 /***********************************************************************************************************************************
 *** FUNCIONES GLOBALES AL MODULO
 **********************************************************************************************************************************/


/*
 * Establece si un determinado PIN de un determinado PUERTO (previamente configurado como GPIO) es entrada o salida.
*/
void SetDIR(uint8_t port, uint8_t pin, uint8_t dir){

	volatile uint32_t *p = (volatile uint32_t *) 0x2009C000UL;	//FIO0DIR

	if( dir ){
		*(p + port * 0x8) |= ( 0x1 << pin );
	}
	else{
		*(p + port * 0x8) &= ~( (0x1) << pin );
	}

}


/*
 * Establece el ESTADO de un determinado PIN de un determinado PUERTO.
 * argumento estado: Valor a establecer en el PIN del PUERTO [0 o 1].
*/
void SetPIN(uint8_t port, uint8_t pin, uint8_t estado){

	volatile uint32_t *p = (volatile uint32_t *) 0x2009C01CUL;	//FIO0CLR

	p[ (port*0x8) - estado ] |= (0x1 << pin);

}


/*
 * Devuelve el ESTADO de un determinado PIN de un determinado PUERTO.
 * argumento logic: especificar si se trabaja con lógica estado alto o estado bajo.
*/
uint8_t GetPIN(uint8_t port, uint8_t pin, uint8_t logic){

	// p apunta de los registros FIOxPIN
	volatile uint32_t *p = (volatile uint32_t *) 0x2009C014UL;	// FIO0PIN
	uint8_t in;

	in = ( p[port * 0x08] >> pin ) & 0x1;

	if( logic == BAJO ){
		in = !in;
	}

	if( logic == ALTO ){ /*nada*/ }

	return in;
}
