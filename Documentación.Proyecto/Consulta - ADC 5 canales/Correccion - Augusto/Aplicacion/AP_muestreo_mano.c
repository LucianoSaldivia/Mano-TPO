/*******************************************************************************************************************************//**
 *
 * @file		AP_muestreo_mano.c
 * @brief		--Descripción del Módulo--
 * @date		22/10/2018
 * @author		Esteban Chiama
 *
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** INCLUDES
 **********************************************************************************************************************************/


#include "AP_muestreo_mano.h"


/***********************************************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** PROTOTIPO DE FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

 /***********************************************************************************************************************************
 *** FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

 /***********************************************************************************************************************************
 *** FUNCIONES GLOBALES AL MODULO
 **********************************************************************************************************************************/


void Preparar_y_Enviar( void ){

	uint8_t bufferStatus, flag_Enviar = 0;
	Muestras_Medias_t MuestrasEfectivas;

	bufferStatus = GetBufferStatus();
	if( bufferStatus ==  VECTORES_LLENOS ){
		MuestrasEfectivas = Mediana_de_Buffers();
		flag_Enviar = 1;
	}

	Enlistar();

	if( flag_Enviar == 1 ){
		// transmito la trama con una nueva mano
		EnviarMano( MuestrasEfectivas );
	}

}


void EnviarMano( Muestras_Medias_t ManoMuestreada ) {

	U0_PushTx('#');

	U0_PushTx( (uint8_t) ((ManoMuestreada.m0 >> 8) & 0xFF) );	// envío primero los 4 bits más significativos
	U0_PushTx( (uint8_t) (ADC_sample & 0xFF) );								// envío los 8 restantes

	U0_PushTx(',');

	U0_PushTx( (uint8_t) ((ManoMuestreada.m1 >> 8) & 0xFF) );	// envío primero los 4 bits más significativos
	U0_PushTx( (uint8_t) (ADC_sample & 0xFF) );								// envío los 8 restantes

	U0_PushTx(',');

	U0_PushTx( (uint8_t) ((ManoMuestreada.m2 >> 8) & 0xFF) );	// envío primero los 4 bits más significativos
	U0_PushTx( (uint8_t) (ADC_sample & 0xFF) );								// envío los 8 restantes

	U0_PushTx(',');

	U0_PushTx( (uint8_t) ((ManoMuestreada.m3 >> 8) & 0xFF) );	// envío primero los 4 bits más significativos
	U0_PushTx( (uint8_t) (ADC_sample & 0xFF) );								// envío los 8 restantes

	U0_PushTx(',');

	U0_PushTx( (uint8_t) ((ManoMuestreada.m4 >> 8) & 0xFF) );	// envío primero los 4 bits más significativos
	U0_PushTx( (uint8_t) (ADC_sample & 0xFF) );								// envío los 8 restantes

	U0_PushTx('$');

	return;
}
